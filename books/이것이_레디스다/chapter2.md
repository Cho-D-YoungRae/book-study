# Chapter 2. 빨리 시작해보기

[레디스 명령어 목록](http://redis.io/commands)

## 2.4 기본 명령어

- 데이터형에 따라서 처리할 수 있는 명령이 달라진다.
- 레디스의 명령은 대소문자를 구별하지 않는다.
- 한글과 같이 아스키 문자가 아닌 데이터의 입력도 지원하지만 데이터가 인코딩된 상태로 출력되어 결과 확인이 어렵다.
- 키 이름에 별다른 제한이 없다.
  - : (콜론)이 들어가도 괜찮다.
  - 관례상 콜론은 키에 의미를 부여하는 구분자로 사용
  - 통상적으로 키는 알파벳, 숫자, 콜론을 사용하여 표기
- 명령어의 응답값
  - 상태응답
  - 에러응답
  - 숫자응답
  - 단일 벌크응답
  - 멀티 벌크응답
- 인덱스에서 -1은 마지막 자리를 의미
  - 음수가 입력되면 인덱스를 맨 마지막 부터 센다.

### 2.4.1 문자열 명령

|명령|[set 키 값](https://redis.io/commands/set/)|
|---|---|
|최초 지원|1.0.0|
|시간 복잡도|O(1)|
|응답|<상태응답>, 항상 OK|

- 주어진 키에 값을 저장
- 하나의 키와 하나의 값을 저장
- 동일한 키에 대하여 중복된 쓰기 연산을 아무런 오류없이 수행한다.
  - 덮어쓰기

|명령|[append 키 값](https://redis.io/commands/append/)|
|---|---|
|최초 지원|2.0.0|
|시간 복잡도|O(1)|
|응답|<숫자응답>, 추가된 문자열을 포함한 전체 문자열의 길이|

- 주어진 키가 존재하면 함께 입력된 값을 이미 저장되어 있는 제일 마지막 값의 뒤에 추가
- 문자열값만 유효
- 키가 존재하지 않으면 새로운 set 명령과 동일하게 동작

|명령|[incr 키](https://redis.io/commands/incr/)|
|---|---|
|최초 지원|1.0.0|
|시간 복잡도|O(1)|
|응답|<숫자응답>, 명령이 실행된 후 키의 값|

- 키에 저장된 값을 1씩 증가시키고 그 결과 값을 반환
- 저장된 값이 숫자일 때만 수행

|명령|[decr 키](https://redis.io/commands/decr/)|
|---|---|
|최초 지원|1.0.0|
|시간 복잡도|O(1)|
|응답|<숫자응답>, 명령이 실행된 후 키의 값|

- 키에 저장된 값을 1씩  감소시키고 그 결과 값을 반환
- 저장된 값이 숫자일 때만 수행

### 2.4.2 리스트 명령

- 링크드 리스트
  - 데이터에 하나의 요소를 추가할 때 O(1) 시간
  - 입력 순서의 유지 -> 큐로 사용되기도 함

|명령|[lpush 키 값 [값...]](https://redis.io/commands/lpush/)|
|---|---|
|최초 지원|1.0.0|
|시간 복잡도|O(1)|
|응답|<숫자응답>, 명령이 실행된 후 요소 수|

- 지정된 리스트의 맨 앞쪽에 입력된 요소를 저장

|명령|[lrange 키 시작인덱스 종료인덱스](https://redis.io/commands/lrange/)|
|---|---|
|최초 지원|1.0.0|
|시간 복잡도|O(S+N) S는 시작인덱스, N 범위에 속하는 요소의 개수|
|응답|<멀티 벌크응답>, 해당 범위의 요소들, 존재하지 않을 때 nil|

- 지정된 리스트의 시작인덱스부터 종료인덱스 범위의 요소를 조회

### 2.4.3 셋 명령

- 셋 데이터는 저장된 데이터의 순서를 전혀 보장하지 않는다.

|명령|[sadd 키 값 [값...]](https://redis.io/commands/sadd/)|
|---|---|
|최초 지원|1.0.0|
|시간 복잡도|O(1)|
|응답|<숫자응답>, 성공이면 입력된 값의 개수, 이미 존재하는 값이면 0|

- 지정된 셋에 입력된 값을 저장

|명령|[smembers 키 값](https://redis.io/commands/smembers/)|
|---|---|
|최초 지원|1.0.0|
|시간 복잡도|O(N) N은 입력된 값의 개수|
|응답|<멀티 벌크응답>, 조회된 값 목록, 값이 존재하지 않을 때 nil|

- 지정된 셋에 저장된 모든 값의 목록을 조회

### 2.4.4 정렬된 셋 명령

- 정렬된 셋 데이터를 다루는 명령
- 가장 많이 사용됨
- '셋 데이터'와 동일한 특징을 가지며 부가적으로 저장된 요소에 가중치를 부여하여 오름차순으로 정렬을 제공
- 같은 가중치끼리는 정렬 안정성 없음

|명령|[zadd 키 가중치 값 [가중치 값...]](https://redis.io/commands/zadd/)|
|---|---|
|최초 지원|1.2.0|
|시간 복잡도|O(log(N))|
|응답|<숫자응답>, 성공이면 입력된 값의 개수, 이미 존재하는 값이면 0|

- 정렬된 셋에 가중치와 값으로 이루어진 데이터를 저장
- 이미 존재하는 값일 때는 기존 가중치를 입력된 가중치로 덮어씀

|명령|[zrange 키 시작인덱스 종료인덱스 [withscores]](https://redis.io/commands/zrange/)|
|---|---|
|최초 지원|1.2.0|
|시간 복잡도|O(log(N)+M) N은 입력되어 있는 값의 개수, M은 조회된 값의 개수|
|응답|<멀티 벌크응답>, 조회된 값 목록, 값이 존재하지 않을 때 nil|

- 정렬된 셋에 시작인덱스부터 종료인덱스 범위에 해당하는 값들을 가중치 오름차순으로 조회

### 2.4.5 해시 명령

- 해시 데이터를 다루는 명령의 집합

|명령|[hset 키 필드이름 값](https://redis.io/commands/hset/)|
|---|---|
|최초 지원|2.0.0|
|시간 복잡도|O(1)|
|응답|<숫자응답>, 존재하지 않는 필드일 때 1, 존재하는 필드일 때 0|

- 지정된 해시에 요청한 필드와 값을 저장
- 요청한 필드가 존재할 때는 저장된 값이 업데이트

|명령|[hget 키 필드이름](https://redis.io/commands/hget/)|
|---|---|
|최초 지원|2.0.0|
|시간 복잡도|O(1)|
|응답|<벌크응답>, 지정된 필드가 존재할 때 저장된 값, 아니면 nil|

- 지정된 해시에 요청한 필드와 값을 조회

|명령|[hgetall 키 필드이름](https://redis.io/commands/hgetall/)|
|---|---|
|최초 지원|2.0.0|
|시간 복잡도|O(N) N은 저장된 필드 수|
|응답|<멀티 벌크응답>, 지정된 키에 저장된 모든 필드와 값의 목록|

- 지정된 해시에 저장된 모드 필드와 값을 조회

## 2.5 레디스 성능 측정

> redis-benchmark

|옵션|설명|기본값|
|---|---|---|
|-h \<hostname>|테스트를 수행하기 위해 접속할 레디스 서버의 호스트명|127.0.0.1|
|-p \<port>|테스트를 수행하기 위해 접속할 레디스 서버의 포트|6379|
|-s \<socket>|테스트를 수행하기 위해 접속할 레디스 서버의 유닉스 서버 소켓|-|
|-c \<clients>|테스트를 위한 가상 클라이언트의 동시 접속 수|50|
|-n \<requests>|각 명령의 테스트 횟수|10000|
|-d \<size>|테스트에 사용할 데이터 크기|3|
|-k \<boolean>|테스트를 위한 가상 클라이언트의 접속 유지 여부|1: 접속 유지, 0: 접속 유지하지 않음|
|-r \<keyspacelen>|테스트에 사용할 랜덤 키의 범위|0|
|-P \<numreq>|파이프라인 명령을 사용한 테스트와 파이프라인당 요청할 명령의 개수|0: 파이프라인 미사용|
|-q|테스트 진행 상황을 출력하지 않고 결과만 출력하기|-|
|--csv|테스트 결과를 csv 포맷으로 출력하기|-|
|-l|브레이크(ctrl+c)를 걸기 전까지 계속 수행|-|
|-t \<tests>|쉽표로 구분된 테스트 명령의 목록|-|
|-I|명령 전송 없는 연결 생성 후 브레이크(ctrl+c) 입력 때까지 대기|-|

## 2.6 redis-cli

### 2.6.1 응답시간 측정

```bash
redis-cli --latency
```

- 명령이 서버로 전달되고 나서부터 응답이 돌아오기까지의 시간을 측정
- 사용자의 종료 명령(ctrl+c)을 전달받기 전까지계속 실행
- 시스템의 자원을 적게 사용하므로 대부분의 경우 운영 중에 사용해도 서비스에 큰 지장을 주지 않지만 몇 시간 동안 계속 실행하는 일은 바람직하지 않음

### 2.6.2 주기적인 통계 정보 조회

```bash
redis-cli info cpu
redis-cli info keyspace
redis-cli info stats
```
