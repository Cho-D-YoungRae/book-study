# Chapter 11. 프로덕션 레디 서비스 개발

## 11.1 보안 서비스 개발

- 인증(authentication)
- 인가(authorization)
- 감사(auditing)
- 보안 IPC
- MSA 보안 기본 사상
  - API 게이트웨이는 클라이언트 인증을 담당
  - API 게이트웨이 및 서비스는 투명 토큰(예: JWT)을 이용하여 주체 정보를 주고 받음
  - 서비스는 토큰을 이용하여 주체의 신원/역할 정보를 획득

## 11.2 구성 가능한 서비스 설계

### 11.2.2 풀 기반의 외부화 구성

- 구성 서버 장점
  - 중앙화 구성
    - 모든 구성 프로퍼티를 한곳에서 관리하면 편리
    - 전역 기본값을 정의해서 서비스 단위로 재정의하는 식으로 중복 구성 프로퍼티를 제거할 수 있음
  - 민감한 데이터의 투명한 복호화
    - DB 자격 증명 등 민감한 데이터는 암호화
  - 동적 재구성
    - 수정된 프로퍼티 값을 폴링 등으로 감지해서 자동 재구성

## 11.3 관측 가능한 서비스 설계

- 헬츠 체크(health check) AP
- 로그 수집: 서비스 활동을 로깅하면서 검색/경고 기능이 구현된 중앙 로그 서버에 로그를 출력
- 분산 추적: 각 외부 요청에 ID 를 하나씩 붙여 서비스 사이를 드나드는 과정을 추적
- 예외 추적: 예외 중복 제거, 개발자 알림, 예외별 해결 상황 추적 등을 수행하는 예외 추적 서비스에 예외를 보고
- 애플리케이션 지표: 서비스는 카운터, 게이지 등 지표를 유지하고 수집한 데이터를 지표 서버에 표출
- 감사 로깅: 사용자 액션을 로깅

## 11.4 서비스 개발: 마이크로서비스 섀시 패턴

> 마이크로서비스 섀시(microservice chassis)는 횡단 관심사 처리에 특화된 프레임워크

### 11.4.1 마이크로서비스 섀시

> 스프링부트, 스프링 클라우드 등...

- 외부화 구성
- 헬스 체크
- 애플리케이션 지표
- 서비스 디스커버리
- 회로 차단기
- 분산 추적

### 11.4.2 이제는 서비스 메시로

> 서비스 메시 패턴: 회로 차단기, 분산 추적, 서비스 디스커버리, 부하 분산, 룰 기반 트래픽 라우팅 등 다양한 관심사가 구현된 네트워킹 계층을 통해 서비스를 드나드는 모든 네트워크 트래픽을 라우팅

- 마이크로서비스 섀시는 횡단 관심사를 구현하기 좋은 수단이지만, 사용하는 프로그래밍 언어마다 하나씩 필요하다는 문제
- 서비스 메시는 한 서비스와 다른 서비스, 그리고 외부 애플리케이션 간의 소통을 조정하는 인프라
- 서비스를 드나드는 네트워크 트래픽은 모두 회로 차단기, 분산 추적, 서비스 디스커버리, 부하 분산, 룰 기반 트래픽 라우팅 등 다양한 관심사가 구현된 서비스 메시를 통과=
- TLS 기반의 IPC 로 서비스 간 IPC 를 보안
- 마이크로서비스 섀시는 외부화 구성, 헬스 체크 등 애플리케이션 코드와 단단히 결합된 관심사만 구현하면 됨
  - 단 마이크로서비스 섀시는 분산 추적 정보를 전파하여 분산 추적을 할 수 있게 지원해야 함
