# Chapter 01. 도메인 모델 시작하기

## 1.1 도메인이란?

- 특정 도메인을 위한 소프트웨어라고 해서 도메인이 제공해야 할 모든 기능을 직접 구현하는 것은 아님
- 도메인마다 고정된 하위 도메인이 존재하는 것은 아님

## 1.3 도메인 모델

- 기본적으로 도메인 모델은 특정 도메인을 개념적으로 표현한 것
- 도메인을 이해하려면 도메인이 제공하는 기능과 도메인의 주요 데이터 구성을 파악해야 하는데, 이런 면에서 기능과 데이터를 함께 보여주는 **객체 모델**은 도메인을 모델링하기에 적합
- 상태 다이어그램을 이용해서도 도메인의 상태전이를 모델링 할 수 있음
- 클래스 다이어그램이나 상태 다이어그램과 같은 UML 표기법만이 아니라 관계가 중요한 도메인이라면 그래프, 계산 규칙이 중요하다면 수학 공식 등 활용해서 도메인 모델을 만들 수 있음
- 도메인은 다수의 하위 도메인으로 구성되는데, 각 하위 도메인이 다루는 영역은 서로 다르기 때문에 같은 용어라도 하위 도메인마다 의미가 달라질 수 있음
- 도메인에 따라 용어 의미가 결정되므로 여러 하위 도메인을 하나의 다이어그램에 모델링하면 안됨

## 1.4 도메인 모델 패턴

- 도메인 모델은 아키텍처 상의 도메인 계층을 객체 지향 기법으로 구현하는 패턴
- 도메인 규칙을 객체 지향 기법으로 구현하는 패턴이 도메인 모델 패턴
- 핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기 때문에 규칙이 바뀌거나 규칙을 확장해야 할 때 다른 코드에 영향을 덜 주고 변경 내역을 모델에 반영할 수 있게 됨

## 1.5 도메인 모델 도출

- 도메인을 모델링할 때 기본이 되는 작업은 모델을 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것
- 도메인을 구현하다 보면 특정 조건이나 상태에 따라 제약이나 규칙이 달리 적용되는 경우가 많음

## 1.6 엔티티와 밸류

### 1.6.1 엔티티

- 식별자를 가짐
- 식별자는 바뀌지 않고, 고유함
- 식별자가 같으면 엔티티는 같다고 판단할 수 있음

### 1.6.2 엔티티의 식별자 생성

- 식별자 생성 방식
  - 특정 규칙에 따라 생성
  - UUID 나 Nano ID 와 같은 고유 식별자 생성기 사용
  - 값을 직접 입력
  - 일련번호 사용(시퀀스나 DB의 자동 증가 칼럼 사용)
- 자동 증가 칼럼은 DB 테이블에 데이터를 삽입해야 비로소 값을 알 수 있기 때문에 테이블에 데이터를 추가하기 전에는 식별자를 알 수 없고, 이것은 엔티티 객체를 생성할 때 식별자를 전달할 수 없음을 의미

### 1.6.3 밸류 타입

- 밸류 타입은 개념적으로 환전한 하나를 표현할 때 사용
- 밸류 타입이 꼭 두 개 이상의 데이터를 가져야 하는 것은 아님
  - 의미를 명확하게 표현하기 위해 밸류 타입을 사용하는 경우도 있음
  - 예) int 대신 Money 밸류 타입을 사용할 수 있음
- 밸류 타입읠 위한 기능을 추가할 수 있음
- 밸류 객체의 데이터를 변경할 때는 기존 데이터를 변경하기보다는 변경한 데이터를 갖는 새로운 밸류 객체를 생성하는 방식을 선호
- 밸류 타입을 불변으로 구현하는 여러 이유가 있는데, 가장 중요한 이유는 안전한 코드를 작성할 수 있다는 데 있음
  - 밸류 타입이 불변이 아니라면 값이 변경되어 잘못 반영되는 상황을 방지하기 위해 다른 객체의 생성자에서 새로운 밸류 타입을 생성해서 참조하도록 코드를 작성해야 함
- 두 밸류 객체를 비교할 때는 모든 속성이 같은지 비교

### 1.6.4 엔티티 식별자와 밸류 타입

- 엔티티 식별자의 실제 데이터는 신용카드 번호, 이메일 등 String 과 같은 문자열로 구성된 경우가 많음
- 이런 식별자는 단순한 문자열이 아니라 도메인에서 특별한 의미를 지니는 경우가 많기 때문에 식별자를 위한 밸류 타입을 사용해서 의미가 잘 드러나도록 할 수 있음

### 1.6.5 도메인 모델에 set 메서드 넣지 않기

- 도메인 모델에 get/set 메서드를 무조건 추가하는 것은 좋지 않은 버릇
- set 메서드는 도메인의 핵심 개념이나 의도를 코드에서 사라지게 함
  - `changeShippingInfo()` 가 배송지 정보를 새로 변경한다는 의미를 가졌다면 `setShippingInfo()` 메서드는 단순히 배송지 값을 설정한다는 것을 의미
- set 메서드의 또 다른 문제는 도메인 객체를 생성할 떄 온전하지 않은 상태가 될 수 있음
  - 도메인 객체를 기본 생성자로 생성 후 set 메서드로 필요한 모든 값을 전달하다 보면 누락되는 값이 발생할 수 있음
  - 도메인 객체가 불완전한 상태로 사용되는 것을 막으려면 생성 시점에 필요한 것을 전달해 주어야 함
- set 메서드를 필요 시 private 으로 사용하여 외부에서 데이터를 변경할 목적으로 set 메서드를 사용하지 않도록 함
- 불변 밸류 타입을 사용하면 자연스럽게 밸류 타입에는 set 메서드를 구현하지 않음

## 1.7 도메인 용어와 유비쿼터스 언어

- 코드를 작성할 때 도메인에서 사용하는 용어는 매우 중요. 도메인에서 사용하는 용어를 코드에 반영하지 않으면 그 코드는 개발자에게 코드의 의미를 해석해야 하는 부담을 줌.
- 유비쿼터스 언어: 전문가, 관계자, 개발자가 도메인과 관련된 공통의 언어를 만들고 이를 대화, 문서, 도메인 모델, 코드, 테스트 등 모든 곳에서 같은 용어를 사용하여 소통 과정에서 발생하는 용어의 모호함을 줄이고 개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄임
